<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Форма платежа</title>
    <!-- Подключаем Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Иконки Bootstrap Icons для вопросиков -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Стили для полей readonly */
        input[readonly], textarea[readonly] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h3 class="card-title">Форма платежа</h3>
            </div>
            <div class="card-body">
                <form action="/submit" method="post">
                    <!-- Получатель - Наименование -->
                    <div class="mb-3">
                        <label for="recipient-name" class="form-label">Получатель - Наименование:</label>
                        <input type="text" id="recipient-name" name="recipient-name" class="form-control" required>
                    </div>

                    <!-- Получатель - адрес - страна -->
                    <div class="mb-3">
                        <label for="recipient-country" class="form-label">Получатель - адрес - страна:</label>
                        <input type="text" id="recipient-country" name="recipient-country" class="form-control" required>
                    </div>

                    <!-- Получатель - адрес - город -->
                    <div class="mb-3">
                        <label for="recipient-city" class="form-label">Получатель - адрес - город:</label>
                        <input type="text" id="recipient-city" name="recipient-city" class="form-control" required>
                    </div>

                    <!-- Банк получателя - SWIFT -->
                    <div class="mb-3">
                        <label for="bank-swift" class="form-label">
                            Банк получателя - SWIFT:
                            <i class="bi bi-question-circle" data-bs-toggle="tooltip" title="SWIFT-код должен состоять из 8 или 11 символов (буквы и цифры)."></i>
                        </label>
                        <input type="text" id="bank-swift" name="bank-swift" class="form-control" pattern="[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?" required>
                    </div>

                    <!-- Банк получателя - наименование -->
                    <div class="mb-3">
                        <label for="bank-name" class="form-label">Банк получателя - наименование:</label>
                        <input type="text" id="bank-name" name="bank-name" class="form-control" readonly>
                    </div>

                    <!-- Номер счета получателя -->
                    <div class="mb-3">
                        <label for="account-number" class="form-label">Номер счета получателя:</label>
                        <input type="text" id="account-number" name="account-number" class="form-control" required autocomplete="off" pattern="^[A-Z0-9]{15,34}$">
                    </div>

                    <!-- Назначение платежа -->
                    <div class="mb-3">
                        <label for="payment-purpose" class="form-label">
                            Назначение платежа:
                            <i class="bi bi-question-circle" data-bs-toggle="tooltip" title="Просьба выбрать наиболее подходящую группу товаров из списка."></i>
                        </label>
                        <select id="payment-purpose" name="payment-purpose" class="form-select" required>
                            <option value="EQUIPMENT">EQUIPMENT</option>
                            <option value="MATERIALS">MATERIALS</option>
                            <option value="INSTRUMENTS">INSTRUMENTS</option>
                            <option value="SPARE_PARTS">SPARE PARTS</option>
                            <option value="COMMISSION_FEES">COMMISSION FEES</option>
                            <option value="SUPPLY_OF_GOODS">SUPPLY OF GOODS</option>
                            <option value="CONSULTING_SERVICES">CONSULTING SERVICES</option>
                            <option value="FREIGHT_OF_GOODS">FREIGHT OF GOODS</option>
                            <option value="TRANSFER_OF_OWN_FUNDS">TRANSFER OF OWN FUNDS</option>
                            <option value="EQUIPMENT_REPAIR">EQUIPMENT REPAIR</option>
                        </select>
                    </div>

                    <!-- Номер инвойса -->
                    <div class="mb-3">
                        <label for="invoice-nr" class="form-label">Номер инвойса:</label>
                        <input type="text" id="invoice-nr" name="invoice-nr" class="form-control" required autocomplete="off">
                    </div>

                    <!-- Дата инвойса -->
                    <div class="mb-3">
                        <label for="invoice-date" class="form-label">Дата инвойса:</label>
                        <input type="date" id="invoice-date" name="invoice-date" class="form-control" required>
                    </div>

                    <!-- Импортный(е) контракт(ы) -->
                    <div class="mb-3">
                        <label for="contract-details" class="form-label">Импортный(е) контракт(ы) - номер(а) и дата(ы):</label>
                        <input type="text" id="contract-details" name="contract-details" class="form-control" required autocomplete="off">
                    </div>

                    <!-- Банк корреспондент - SWIFT -->
                    <div class="mb-3">
                        <label for="correspondent-bank-swift" class="form-label">
                            Банк корреспондент - SWIFT:
                            <i class="bi bi-question-circle" data-bs-toggle="tooltip" title="SWIFT-код должен состоять из 8 или 11 символов (буквы и цифры)."></i>
                        </label>
                        <input type="text" id="correspondent-bank-swift" name="correspondent-bank-swift" class="form-control" pattern="[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?" autocomplete="off">
                    </div>

                    <!-- Банк корреспондент - наименование -->
                    <div class="mb-3">
                        <label for="correspondent-bank-name" class="form-label">Банк корреспондент - наименование:</label>
                        <input type="text" id="correspondent-bank-name" name="correspondent-bank-name" class="form-control" readonly>
                    </div>

                    <!-- Комментарий к платежу -->
                    <div class="mb-3">
                        <label for="payment-comment" class="form-label">Комментарий к платежу:</label>
                        <textarea id="payment-comment" name="payment-comment" class="form-control"></textarea>
                    </div>

                    <!-- Кнопка отправки -->
                    <div class="mb-3">
                        <button type="submit" class="btn btn-primary">Отправить</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Подключаем Bootstrap JS и Popper.js для работы Tooltip -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script>
        // Функция для получения наименования банка по SWIFT-коду через Swift Codes API
        async function fetchBankName(swiftCode) {
            try {
                // Запрос к Swift Codes API (поменять на рабочий API)
                const response = await fetch(`https://api.swiftcodesapi.com/v1/swift-codes/${swiftCode}/`);
                const data = await response.json();

                if (data.bank) {
                    return data.bank.name; // Возвращаем наименование банка
                } else {
                    return "Банк не найден";
                }
            } catch (error) {
                console.error("Ошибка при запросе к API:", error);
                return "Ошибка при получении данных";
            }
        }

        // Обработчик события для поля SWIFT (банк получателя)
        document.getElementById('bank-swift').addEventListener('input', async function () {
            const swiftCode = this.value.trim().toUpperCase(); // Приводим к верхнему регистру
            const bankNameInput = document.getElementById('bank-name');

            if (swiftCode.length === 8 || swiftCode.length === 11) {
                const bankName = await fetchBankName(swiftCode);
                bankNameInput.value = bankName;
            } else {
                bankNameInput.value = ""; // Очищаем поле, если SWIFT-код невалиден
            }
        });

        // Обработчик события для поля SWIFT (банк корреспондент)
        document.getElementById('correspondent-bank-swift').addEventListener('input', async function () {
            const swiftCode = this.value.trim().toUpperCase(); // Приводим к верхнему регистру
            const bankNameInput = document.getElementById('correspondent-bank-name');

            if (swiftCode.length === 8 || swiftCode.length === 11) {
                const bankName = await fetchBankName(swiftCode);
                bankNameInput.value = bankName;
            } else {
                bankNameInput.value = ""; // Очищаем поле, если SWIFT-код невалиден
            }
        });

        // Активируем подсказки (tooltips)
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
</body>
</html>
